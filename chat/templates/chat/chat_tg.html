{% load static %}
<html>
<head>
  <meta charset="utf-8">
  <title>WS Debug</title>
  <link href="https://cdn.jsdelivr.net/npm/bootstrap-icons/font/bootstrap-icons.css" rel="stylesheet">

  <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.0.2/dist/css/bootstrap.min.css" rel="stylesheet" integrity="sha384-EVSTQN3/azprG1Anm3QDgpJLIm9Nao0Yz1ztcQTwFspd3yD65VohhpuuCOmLASjC" crossorigin="anonymous">
  <link rel="stylesheet" href="{% static 'bootstrap/style/Nurbol.css' %}">
</head>
<body>
  <div class="container-fluid" style="padding: 0;margin: 0;">
    <div class="row g-0">
      
      <div class="col-lg-4" style="background-color: #212529;min-height: 100vh;border-right: 1px solid rgba(255, 255, 255, 0.2);">
        <div class="nav" style="background-color: #212529;display: flex; height: 70px;gap: 10px; align-items: center;">
          <a id="btn-menu" class="btn-menu">
            <span></span>
            <span></span>
            <span></span>
          </a>
          <div id="chat-menu" class="chat-menu">
            <a href="{% url 'm_benz:showroom' %}">Автосалон</a>
            <a href="{% url "m_benz:my_cars" %}">Мои машины</a>
            <a href="{% url "store:my_orders" %}">Мои заказы</a>
            <a href="{% url 'store:liked' %}">Избранные</a>
          </div>
          <p style="color: aliceblue;font-size: 21px;margin: 0;line-height: 1;">Сообщения</p>
        </div>
        {% for room in rooms %}
          <a href="#" class="chat_item" 
            data-room="{{room.id}}"
            data-car-id="{{room.last_message.car.id}}"
            data-user-a="{{room.user_a}}" 
            data-user-b="{{room.user_b}}" 
            data-car-img="{{room.last_message.car.images.first.image.url}}"
            style="text-decoration: none;"> 
            <div class="chats">
              <img src="{{room.last_message.car.images.first.image.url}}" style="width: 90px;height: 65px;object-fit:inherit;border-radius: 10px;" alt="">
              <div style="display: flex;flex-direction:column;justify-content: space-between;height: 65px;">
               <p style="color: #f1f1f1;">
                  {% if room.user_a != request.user %}
                    <strong>{{room.user_a}}</strong>
                  {% else %}
                    <strong>{{room.user_b}}</strong>
                  {% endif %}
                 
                </p>
  
                <p id="chat-{{room.id}}-p" class="chat-p" style="color: #787878ff;">{{room.last_message.text}}</p>
              </div>
              <div>

              </div>
            </div>
          </a>
        {% endfor %}
      </div>

      <div class="col-lg-8">
        <div class="nav" style="background-color: #212529;height: 70px;gap: 20px; align-items: center;">
          <img id="chat-img" style="display: none; margin-left: 20px; width: 70px;height: 50px;object-fit:inherit;border-radius: 5px;" alt="">
          <strong><p id="chat-header" style="color: #ffffffff;font-size: 18px;margin: 0;"></p></strong>
        </div>
        <div id="chat-container">
          

              <div id="chat-messages" class="chattg-messages">
                <div class="messages">
                  {% for msg in msgs %}
                    <div>
                      {{msg.created}}
                    </div>

                    {% endfor %}
                </div>
              </div>
          <div id="chat-input-container" class="chat-input-container" style="display: none;">
                <input 
                    data-current-user-id="{{request.user.username}}"
                    data-car="{{room.last_message.car}}"
                    type="text"
                    style="height: 50px;width: 500px;border-radius: 30px;padding-left: 10px;align-items: center;background: #f1f1f1;" placeholder="Напишите сообщение..."
                    id="chat-input">
                <button class="chat-tg-btn" type="submit" id="message-send"><img src="{% static 'bootstrap/style/photo/send.png' %}" style="margin-left: 3px; max-width: 20px;max-height: 20px;object-fit: contain;" alt=""></button>
          </div>

        </div>
      </div>
      
    </div>
  </div>

  <script src="{% static 'bootstrap/style/js/chat_tg.js' %}"></script>
</body>
</html>
