{% extends "m_benz/Nurbol.html" %}
{% load static %}
{% load humanize %}
{% block nav-link %}
  <a class="nav-link" aria-current="page" href="{% url 'm_benz:Nurbol' %}">Домой</a>
  <a class="nav-link" href="{% url 'm_benz:showroom' %}">Автосалон</a>
  {% if user.is_authenticated %}
    <a href="{% url "store:cart" %}"><img src="{% static "bootstrap/style/big-handbag.png" %}" style="width:30px"></a>
    <nav class="navbar navbar-expand-lg navbar-dark bg-dark">
      <div class="container-fluid">
        <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbarNavDarkDropdown" aria-controls="navbarNavDarkDropdown" aria-expanded="false" aria-label="Toggle navigation">
          <span class="navbar-toggler-icon"></span>
        </button>
        <div class="collapse navbar-collapse" id="navbarNavDarkDropdown">
          <ul class="navbar-nav">
            <li class="nav-item dropdown">
              <button class="btn btn-dark dropdown-toggle" style="font-size: 20px" data-bs-toggle="dropdown" aria-expanded="false">
                {{user.username}}
              </button>
              <ul class="dropdown-menu dropdown-menu-dark" style="background-color: #212529;font-size: 17px;color:aliceblue;">
                <li>
                  <a class="dropdown-item" href="{% url "m_benz:my_cars" %}">Мои машины</a>
                </li>
                
                <li>
                  <a class="dropdown-item" href="{% url 'store:liked' %}">Избранные</a>
                </li>

                <li>
                  <a class="dropdown-item" href="{% url "store:my_orders" %}">Мои заказы</a>
                </li>

                <li>
                  <a class="dropdown-item" href="{% url 'chat:chat_tg'  %}">Чат</a>
                </li>
                
                <li>
                  <a class="dropdown-item" href="{% url "m_benz:add_car" %}">Подать объявления</a>
                </li>
                
                <li>
                  <a class="dropdown-item" href="#" onclick="event.preventDefault(); document.getElementById('logout-form').submit();">Log out</a>
                  <form method="POST" id="logout-form" style="display:none" action="{% url 'users:logout' %}">
                    {% csrf_token %}
                    <input type="hidden" name="next" value="{% url 'm_benz:showroom' %}">
                  </form>
                </li>
              </ul>
            </li>
          </ul>
        </div>
      </div>
    </nav>
  {% else %}
    <a class="nav-link" href="{% url "users:login" %}">Войти</a>
    <a class="nav-link" href="{% url "users:register" %}">Регистрация</a>
  {% endif %}
{% endblock nav-link %}
 

{% block section %}
    <div class="container-fluid">
      <div class="car_site_body">
        <div class="row">
            <div class="col-lg-4">
              <div class="car-info">
                <div><p style="font-size: 23px; color:black">{{car.name}} {{car.year}}</p></div>
                  {% if user == car.owner %}
                    <div><a href="{% url "m_benz:edit_car" car.id%}">Изменить</a></div>
                  {% else %}
                    {% if car.quantity == 0 %}
                      <button  class="btn btn-danger">
                        Нет в наличии
                      </button>
                    {% else %}
                      <button type="button" class="btn btn-primary" data-bs-toggle="modal" data-bs-target="#cartModal">
                        Добавить в корзину
                      </button>
                    {% endif %}
                    <!-- Модальное окно -->
                    <div class="modal fade" id="cartModal" tabindex="-1" aria-hidden="true">
                      <div class="modal-dialog modal-lg">
                        <div class="modal-content">
                          <div class="modal-header">
                            <h5 class="modal-title">Товар добавлен в корзину</h5>
                            <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Закрыть"></button>
                          </div>
                          <form action='{% url "store:add_to_cart" car.id %}' method="POST">
                            {% csrf_token %}
                            <div class="modal-body">
                              <div class="container">
                                <div class="row">
                                  <div class="col-lg-3"> 
                                    <img class="cart_image" style="width: 100%;max-width:180px;height: 120px;border-radius: 8px;rid-row: 1 / span 2;" src="{{car.images.first.image.url}}">
                                  </div>
                                  <div class="col-lg-6">
                                    <div>
                                      <p>{{car.name}}</p>
                                      <p>{{car.engine_capacity}} L, {{car.mileage}} km</p>
                                      <p>{{car.color}}</p>
                                    </div>
                                  </div>
                                  <div class="col-lg-3">
                                    <div class="cart_price_modal">
                                      <p>{{car.price}} $</p>
                                      <div class="mt-3">
                                        <label for="quantity" class="form-label">Количество:</label>
                                        <input type="number" min="1" name="quantity" id="quantity" class="form-control" value="1">
                                      </div>
                                    </div>
                                  </div>
                                </div>
                              </div>
                            </div> 
                            <div class="modal-footer">
                               <button type="submit" class="btn btn-dark">Добавить в корзину</button>
                            </div>
                          </form>           
                        </div>
                      </div>
                    </div>
                  {% endif %}
                    <div><h2 style="color:black"><strong>{{car.price}}$</strong></h2></div>
                    <div 
                      class="like" style="position: relative;cursor: pointer;" 
                      data-url="{% url 'store:toggle_favorite' %}"
                      data-car-id="{{ car.id }}"
                    >
                      <img class="heart" 
                      id="heart" src="{% static 'bootstrap/style/photo/black_heart.png' %}"
                      data-red="{% static 'bootstrap/style/photo/red_heart.png' %}"
                      data-black="{% static 'bootstrap/style/photo/black_heart.png' %}"
                      
                      alt="">

                    </div>
                    <div>Город</div><div>{{car.city}}</div>
                    <div>Поколение</div><div>{{car.generation}}</div>
                    <div>Кузов</div><div>{{car.car_body}}</div>
                    <div>Объем двигателя</div><div>{{car.engine_capacity}}</div>
                    <div>Пробег</div><div>{{car.mileage}} km</div>
                    <div>Коробка передач</div><div>{{car.drive_type}}</div>
                    <div>Привод</div><div>{{car.drivetrain}}</div>
                    <div>Руль</div><div>{{car.steering_wheel}}</div>
                    <div>Цвет</div><div>{{car.color}}</div>
                      

                     
                    <div style="display: flex; justify-content: center; align-items: center;">
                      <div class="card shadow p-4" style="width: 18rem;border-radius:20px">
                        <div class="card-body">
                          <p style="color: gray;margin:0px">Владелец машины</p>
                          <h2 class="card-title">{{car.owner}}</h2>
                          <p class="card-text" style="color: gray">Номер телефона</p>
                          <h5 class="card-subtitle mb-2 text-body-secondary">{{car.owner.phone_number}}</h5>
                          <a href="{% url 'chat:chat_owner' car.id %}" class="btn btn-primary">Написать сообщение</a>
                        </div>
                      </div>
                    </div>
                    <div></div>
              </div>
            </div>
    

            <div class="col-lg-8">
              <div class="container">
                <div class="row">
                    <div class="car-main">
                      <div id="carouselExample" class="carousel slide">
                        <div class="carousel-inner">
                          <div class="carousel-item active">
                            <img src="{{car.images.first.image.url}}" style="height:520px;object-fit: cover" class="d-block w-100" alt="...">
                          </div>
                          {% for image in car.images.all|slice:"1:" %}
                            <div class="carousel-item">
                              <img src="{{image.image.url}}" style="height:520px;object-fit: cover" class="d-block w-100" alt="...">
                            </div>
                          {% endfor %}
                        </div>
                        <button class="carousel-control-prev" type="button" data-bs-target="#carouselExample" data-bs-slide="prev">
                          <span class="carousel-control-prev-icon" aria-hidden="true"></span>
                          <span class="visually-hidden">Previous</span>
                        </button>
                        <button class="carousel-control-next" type="button" data-bs-target="#carouselExample" data-bs-slide="next">
                          <span class="carousel-control-next-icon" aria-hidden="true"></span>
                          <span class="visually-hidden">Next</span>
                        </button>
                      </div>
                      <h3>Коментарий продавца</h3>
                      <p>{{car.description}}</p>
                    </div>
                </div>
              </div>
            </div>
            <div class="col-lg-0"></div>
          </div>
        </div>
    </div>

<script src="{% static 'bootstrap/style/js/chat_owner.js' %}"></script>
<script src="{% static 'bootstrap/style/js/like.js' %}"></script>
{% endblock section %}







{% block footer %}
<footer>
    <div class="footer">
      <div class="footer-text">
        <a href="#">Помощь на дороге</a>
        <a href="#">Пользовательское соглашение</a>
        <a href="#">Политика конфиденциальности</a>
        <a href="#">Не продавайте мою личную информацию (CCPA)</a>
        
      </div>
      <div class="mersf">
        <a href="{% url "m_benz:Nurbol"%}"><img  src="{% static 'bootstrap/style/mersss.svg' %}" alt="">
        </a>
      </div>
      </div>
  </footer>
  
{% endblock footer %}

